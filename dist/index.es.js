import{Component}from"react";import{connect}from"react-redux";const QUEUE_EVENT="QUEUE_EVENT",CLEAR_EVT_QUEUE="CLEAR_EVT_QUEUE",clearEvtQueue=()=>({type:CLEAR_EVT_QUEUE}),emit=e=>({type:QUEUE_EVENT,event:e});var actionCreators=Object.freeze({clearEvtQueue:clearEvtQueue,emit:emit});const INIT_STATE={events:[]},webAudioReducer=(e=INIT_STATE,t)=>{const n={events:[...e.events]};switch(t.type){case QUEUE_EVENT:queueEvent(e,t,n);break;case CLEAR_EVT_QUEUE:n.events=[]}return n};function queueEvent(e,t,n){Array.isArray(t.event)?t.event.forEach((t,r)=>{n.events.push({key:e.events.length+r,event:t})}):n.events.push({key:e.events.length,event:t.event})}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){_defineProperty(e,t,n[t])})}return e}class RRWA extends Component{constructor(e){super(e),_defineProperty(this,"processEvent",({event:e})=>{e(this.audioContext,this.getCurrTime)}),_defineProperty(this,"getCurrTime",()=>this.audioContext.currentTime);const t=window.AudioContext||window.webkitAudioContext;if(!t)throw new Error("This environment does not support the web audio API.");this.audioContext=new t}componentDidMount(){this.props.events.length&&(this.props.events.forEach(this.processEvent),this.props.clearQ())}shouldComponentUpdate(e){return e.events.length>0}componentDidUpdate(){this.props.events.length&&(this.props.events.forEach(this.processEvent),this.props.clearQ())}componentWillUnmount(){this.audioContext.close()}render(){return null}}const mapState=({webAudioReducer:e})=>_objectSpread({},e),mapDispatch=e=>({clearQ:()=>e(clearEvtQueue())});var RRWAComponent=connect(mapState,mapDispatch)(RRWA);export{RRWAComponent as RRWAEngine,actionCreators,webAudioReducer};
